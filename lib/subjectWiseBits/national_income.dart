import 'package:flutter/material.dart';
import 'dart:async';

import '../path_to_my_banner_ad_widget.dart'; // Import the dart:async package

class Question {
  final String questionText;
  final List<String> options;
  final int correctAnswerIndex;
  final String explanation;

  Question({
    required this.questionText,
    required this.options,
    required this.correctAnswerIndex,
    required this.explanation,
  });
}

class national_income extends StatefulWidget {
  final String? userIdentifier;

  national_income({Key? key, this.userIdentifier}) : super(key: key);

  @override
  State<national_income> createState() => _national_incomeState();
}

class _national_incomeState extends State<national_income> {
  int? _selectedAnswerIndex;
  int _currentQuestionIndex = 0;
  List<int?> _userAnswers = List.filled(100, null); // Initialize with the number of questions

  List<Question> _questions = [


    Question(
      questionText: "What is National Income, and how is it defined?",
      options: [
        "The total income earned by a nation through exports and imports.",
        "The total value of all final goods and services produced in a country in a specific period.",
        "The income generated by the government through taxes and subsidies.",
        "The total value of all goods and services consumed by citizens in a country."
      ],
      correctAnswerIndex: 1,
      explanation: "National Income is defined as the total value of all final goods and services produced in a country in a specific period (usually one year).",
    ),
    Question(
      questionText: "What are the measures of National Income?",
      options: [
        "GDP, GNP, NNP, PI, DPI",
        "GNP, CPI, WPI, GDP Deflator",
        "Personal Income, Disposable Personal Income, Nominal Income",
        "GDP, NNP, CPI, DPI, GDP Deflator"
      ],
      correctAnswerIndex: 0,
      explanation: "Measures of National Income include GDP, GNP, NNP, PI (Personal Income), and DPI (Disposable Personal Income).",
    ),
    Question(
      questionText: "What is GDP, and how is it calculated?",
      options: [
        "The total value of goods and services produced by citizens and foreign nationals.",
        "The total value of final goods and services produced within the geographical boundary of a country in a specific period.",
        "The total income received by individuals after deducting direct taxes.",
        "The total value of goods produced by Indians in India as well as abroad."
      ],
      correctAnswerIndex: 1,
      explanation: "GDP is the total value of final goods and services produced within the geographical boundary of a country in a specific period (usually one year).",
    ),
    Question(
      questionText: "What is GNP, and how is it different from GDP?",
      options: [
        "The total value of goods produced by resident and non-resident citizens; Excludes income of foreigners in India.",
        "The total income received by individuals after deducting direct taxes.",
        "The total value of final goods and services produced abroad by Indian nationals.",
        "The total value of final goods and services produced by Indians in India."
      ],
      correctAnswerIndex: 0,
      explanation: "GNP is the total value of goods produced by resident and non-resident citizens of a country, excluding the income of foreigners who reside in India.",
    ),
    Question(
      questionText: "What is Net National Product (NNP), and how is it calculated?",
      options: [
        "Total income received by individuals after deducting direct taxes.",
        "Total value of final goods and services produced by Indians abroad.",
        "GNP minus Depreciation.",
        "Total value of final goods and services produced by Indians in a specific period."
      ],
      correctAnswerIndex: 2,
      explanation: "NNP is calculated by deducting depreciation from Gross National Product (GNP): NNP = GNP – Depreciation.",
    ),
    Question(
      questionText: "What is Personal Income, and how is it calculated?",
      options: [
        "Total value of goods and services consumed by citizens.",
        "Total income received by individuals after deducting direct taxes.",
        "Total income earned by a nation through exports and imports.",
        "Total value of final goods and services produced by Indians in India."
      ],
      correctAnswerIndex: 1,
      explanation: "Personal Income is the sum of all income received by the people of the country in one year, calculated as National Income + Transfer payments – Undisclosed profits of corporate + Payment for social security provisions.",
    ),
    Question(
      questionText: "What is Disposable Personal Income, and how is it calculated?",
      options: [
        "Income available to individuals after deducting direct taxes.",
        "Income available to individuals before deducting direct taxes.",
        "Income available to businesses after deducting indirect taxes.",
        "Income available to businesses before deducting indirect taxes."
      ],
      correctAnswerIndex: 0,
      explanation: "Disposable Personal Income is the income available to individuals after deducting direct taxes: DPI = Personal Income – Direct Taxes.",
    ),
    Question(
      questionText: "What is Real Income, and how does it differ from Nominal Income?",
      options: [
        "Income measured using base year price; Nominal income measured using current year price.",
        "Income measured using current year price; Nominal income measured using base year price.",
        "Income measured using foreign exchange rates; Nominal income measured using domestic currency.",
        "Income measured using government set prices; Nominal income measured using market prices."
      ],
      correctAnswerIndex: 0,
      explanation: "Real Income is income measured using base year prices, while Nominal Income is measured using current year prices.",
    ),
    Question(
      questionText: "What is the GDP Deflator, and how is it calculated?",
      options: [
        "A measure of overall price rise; calculated as (Nominal GDP/Real GDP) × 100.",
        "A measure of inflation based on Consumer Price Index.",
        "A measure of market price fluctuations; calculated as (Market Price - Factor Cost) / Indirect Taxes.",
        "A measure of exchange rate fluctuations; calculated as (Domestic Price Index/Foreign Price Index) × 100."
      ],
      correctAnswerIndex: 0,
      explanation: "The GDP Deflator is a measure of overall price rise, calculated as (Nominal GDP/Real GDP) × 100.",
    ),
    Question(
      questionText: "When was the first attempt made to calculate National Income, and who wrote the book 'Poverty and Un-British Rule in India'?",
      options: [
        "1930, Jawahar Lal Nehru",
        "1868, Dadabhai Naoroji",
        "1949, P.C. Mahalanobis",
        "1925-29, Dr. V.K.R.V. Rao"
      ],
      correctAnswerIndex: 1,
      explanation: "The first attempt to calculate National Income was in 1868 when Dadabhai Naoroji wrote the book 'Poverty and Un-British Rule in India.'",
    ),
    Question(
      questionText: "Who estimated National Income scientifically for the period 1925-29?",
      options: [
        "P.C. Mahalanobis",
        "Jawahar Lal Nehru",
        "Dr. V.K.R.V. Rao",
        "Dadabhai Naoroji"
      ],
      correctAnswerIndex: 2,
      explanation: "Dr. V.K.R.V. Rao estimated National Income scientifically for the period 1925-29.",
    ),
    Question(
      questionText: "When was the National Income Committee formed after Independence?",
      options: [
        "1925-29",
        "1868",
        "1949",
        "2015"
      ],
      correctAnswerIndex: 2,
      explanation: "The National Income Committee was formed in 1949 after Independence under the chairmanship of P.C. Mahalanobis.",
    ),
    Question(
      questionText: "Which organization was formed after the National Income Committee, and what was its role?",
      options: [
        "Labour Bureau",
        "Central Statistical Organisation (CSO)",
        "National Development Council (NDC)",
        "NITI Aayog"
      ],
      correctAnswerIndex: 1,
      explanation: "After the National Income Committee, the Central Statistical Organisation (CSO) was formed to play a role in the estimation of National Income in India.",
    ),
    Question(
      questionText: "What are the various weighted price indices calculated in India?",
      options: [
        "CPI, WPI, GDP Deflator",
        "Wholesale Price Index (WPI), Old Consumer Price Index, New Consumer Price Index, Consumer Food Price Index",
        "GDP, NNP, CPI, DPI",
        "GNP, CPI- IW, CPI- UNME, CPI- AL, CPI- RL"
      ],
      correctAnswerIndex: 1,
      explanation: "Various weighted price indices calculated in India include Wholesale Price Index (WPI), Old Consumer Price Index, New Consumer Price Index, and Consumer Food Price Index.",
    ),
    Question(
      questionText: "What is the current base year for the Wholesale Price Index (WPI) in India?",
      options: [
        "2011-12",
        "2001",
        "2012",
        "1986-87"
      ],
      correctAnswerIndex: 0,
      explanation: "The current base year for the Wholesale Price Index (WPI) in India is 2011-12.",
    ),
    Question(
      questionText: "What does the Wholesale Price Index (WPI) measure?",
      options: [
        "Change in the price of commodities traded in the wholesale market.",
        "Overall inflation based on market prices.",
        "Change in the price of goods consumed by industrial workers.",
        "Exchange rate fluctuations based on foreign trade."
      ],
      correctAnswerIndex: 0,
      explanation: "The Wholesale Price Index (WPI) measures the change in the price of commodities traded in the wholesale market.",
    ),
    Question(
      questionText: "Which organization publishes the Wholesale Price Index (WPI) in India?",
      options: [
        "Central Statistical Organisation (CSO)",
        "Labour Bureau",
        "Economic Advisor, Ministry of Commerce & Industry",
        "National Development Council (NDC)"
      ],
      correctAnswerIndex: 2,
      explanation: "The Wholesale Price Index (WPI) in India is published by the Economic Advisor, Ministry of Commerce & Industry.",
    ),
    Question(
      questionText: "What is the Consumer Price Index for Industrial Workers (CPI- IW), and who publishes it?",
      options: [
        "Measures the change in the price of commodities consumed by industrial workers; Published by Labour Bureau.",
        "Measures the change in the price of commodities consumed by urban non-manual employees; Published by CSO.",
        "Measures the change in the price of commodities consumed by agriculture labourers; Published by Labour Bureau.",
        "Measures the change in the price of commodities consumed by rural labourers; Published by Labour Bureau."
      ],
      correctAnswerIndex: 0,
      explanation: "The Consumer Price Index for Industrial Workers (CPI- IW) measures the change in the price of commodities consumed by industrial workers and is published by the Labour Bureau.",
    ),
    Question(
      questionText: "What is the current base year for the Consumer Price Index for Industrial Workers (CPI- IW) in India?",
      options: [
        "2011-12",
        "2001",
        "2012",
        "1986-87"
      ],
      correctAnswerIndex: 1,
      explanation: "The current base year for the Consumer Price Index for Industrial Workers (CPI- IW) in India is 2001.",
    ),
    Question(
      questionText: "What is the Consumer Price Index for Urban Non-Manual Employees (CPI- UNME), and who used to publish it?",
      options: [
        "Measures the change in the price of commodities consumed by urban non-manual employees; Published by CSO.",
        "Measures the change in the price of commodities consumed by agriculture labourers; Published by Labour Bureau.",
        "Measures the change in the price of commodities consumed by rural labourers; Published by Labour Bureau.",
        "Measures the change in the price of commodities traded in the wholesale market; Published by Economic Advisor."
      ],
      correctAnswerIndex: 1,
      explanation: "The Consumer Price Index for Urban Non-Manual Employees (CPI- UNME) measures the change in the price of commodities consumed by urban non-manual employees and used to be published by CSO.",
    ),
    Question(
      questionText: "What is the current base year for the Consumer Price Index for Agriculture Labourers (CPI- AL) in India?",
      options: [
        "2011-12",
        "2001",
        "2012",
        "1986-87"
      ],
      correctAnswerIndex: 2,
      explanation: "The current base year for the Consumer Price Index for Agriculture Labourers (CPI- AL) in India is 1986-87.",
    ),
    Question(
      questionText: "What is the Consumer Price Index for Rural Labourers (CPI- RL), and who publishes it?",
      options: [
      "Measures the change in the price of commodities consumed by agriculture labourers; Published by Labour Bureau.",
      "Measures the change in the price of commodities traded in the wholesale market; Published by Economic Advisor.",
      "Measures the change in the price of goods consumed by industrial worker Published by Labour Bureau.",
    "Measures the change in the price of commodities consumed by urban non-manual employees; Published by CSO."
      ],
      correctAnswerIndex: 0,
      explanation: "The Consumer Price Index for Rural Labourers (CPI- RL) measures the change in the price of commodities consumed by rural labourers (including agriculture labourers) and is published by the Labour Bureau.",
    ),
    Question(
      questionText: "What are the components of the New Consumer Price Index (CPI) introduced in February 2011?",
      options: [
        "CPI (Rural), CPI (Urban), CPI (Combined)",
        "CPI (Urban), CPI (Combined), Consumer Food Price Index",
        "CPI (Rural), CPI (Combined), Consumer Food Price Index",
        "CPI (Rural), CPI (Urban), Consumer Food Price Index"
      ],
      correctAnswerIndex: 0,
      explanation: "The components of the New Consumer Price Index (CPI) introduced in February 2011 include CPI (Rural), CPI (Urban), and CPI (Combined).",
    ),
    Question(
      questionText: "What is the Consumer Food Price Index, and why is it used?",
      options: [
        "Measures the change in the price of commodities traded in the wholesale market.",
        "Measures the change in the price of food items consumed by the people.",
        "Measures the change in the price of commodities consumed by agriculture labourers.",
        "Measures the change in the price of goods consumed by industrial workers."
      ],
      correctAnswerIndex: 1,
      explanation: "The Consumer Food Price Index measures the change in the retail prices of food items consumed by the people.",
    ),
    Question(
      questionText: "What is the GDP Deflator, and how is it calculated?",
      options: [
        "A measure of overall price rise; calculated as (Nominal GDP/Real GDP) × 100.",
        "A measure of inflation based on Consumer Price Index.",
        "A measure of market price fluctuations; calculated as (Market Price - Factor Cost) / Indirect Taxes.",
        "A measure of exchange rate fluctuations; calculated as (Domestic Price Index/Foreign Price Index) × 100."
      ],
      correctAnswerIndex: 0,
      explanation: "The GDP Deflator is a measure of overall price rise, calculated as (Nominal GDP/Real GDP) × 100.",
    ),
    Question(
      questionText: "Why is the GDP Deflator considered the most accurate measure?",
      options: [
        "It covers only select commodity baskets.",
        "It is published weekly/monthly.",
        "It is based on market prices.",
        "It covers all goods and services produced in the economy."
      ],
      correctAnswerIndex: 3,
      explanation: "The GDP Deflator is considered the most accurate measure because it covers all goods and services produced in the economy, unlike other indices that derive from select commodity baskets.",
    ),
    Question(
      questionText: "Why is the GDP Deflator not commonly used by the government?",
      options: [
        "It is calculated quarterly, not weekly/monthly.",
        "It is based on market prices.",
        "It does not cover all goods and services produced in the economy.",
        "It is less accurate than other indices."
      ],
      correctAnswerIndex: 0,
      explanation: "The GDP Deflator is not commonly used by the government because its data comes quarterly, not on a weekly/monthly basis.",
    ),
    Question(
      questionText: "When was NITI Aayog established, and what role did it play?",
      options: [
        "1950, Formulation of Five-Year Plans.",
        "2015, Replacement of the Planning Commission.",
        "1980, Implementation of Green Revolution.",
        "1992, Launch of New Economic Policy."
      ],
      correctAnswerIndex: 1,
      explanation: "NITI Aayog was established in 2015 as the replacement of the Planning Commission, with the dual objective of achieving sustainable development goals and enhancing cooperative federalism.",
    ),
    Question(
      questionText: "What are the initiatives of NITI Aayog?",
      options: [
        "Three-Year Action Plan, Seven-Year Strategy Plan, Fifteen-Year Vision Plan.",
        "Five-Year Plans, Annual Plans, Decadal Plans.",
        "Liberalization, Privatization, Globalization.",
        "Land Reforms, Self-Reliance, Industrialization."
      ],
      correctAnswerIndex: 0,
      explanation: "The initiatives of NITI Aayog include a Three-Year Action Plan, Seven-Year Strategy Plan, and Fifteen-Year Vision Plan.",
    ),





  ];
  int _elapsedTimeInSeconds = 0; // Elapsed exam time in seconds

  late Timer _examTimer;

  @override
  void initState() {
    super.initState();
    _loadLikedData();
    //_timerValueNotifier = ValueNotifier<int>(_timerSeconds);
    _startriversTimer();
  }
  void _startriversTimer() {
    _examTimer = Timer.periodic(Duration(seconds: 1), (timer) {
      setState(() {
        _elapsedTimeInSeconds++;
      });
    });
  }

  Future<void> _loadLikedData() async {
    // Load liked questions data here
    // ...
  }

  void _nextQuestion() {
    setState(() {
      if (_currentQuestionIndex < _questions.length - 1) {
        _currentQuestionIndex++;
        _selectedAnswerIndex = null;
      } else {
        // All questions have been answered, navigate to results screen
        _navigateToResults();
      }
    });
  }

  void _previousQuestion() {
    setState(() {
      if (_currentQuestionIndex > 0) {
        _currentQuestionIndex--;
        _selectedAnswerIndex = null;
      }
    });
  }

  void _navigateToResults() {
    // Navigate to results screen
    _examTimer.cancel(); // Cancel the exam timer before navigating
    Navigator.of(context).pushReplacement(
      MaterialPageRoute(
        builder: (context) => ResultsScreen(
          userAnswers: _userAnswers,
          questions: _questions,
          elapsedTimeInSeconds: _elapsedTimeInSeconds,
        ),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Quiz'), // Set the title to 'Quiz' using Text widget
        backgroundColor: Colors.blueAccent,
      ),
      body: GestureDetector(
        onVerticalDragEnd: (details) {
          if (details.velocity.pixelsPerSecond.dy < 0) {
            // Swipe up detected, move to the next question
            _nextQuestion();
          } else if (details.velocity.pixelsPerSecond.dy > 0) {
            // Swipe down detected, move to the previous question
            _previousQuestion();
          }
        },
        onHorizontalDragEnd: (details) {
          if (details.primaryVelocity! > 0) {
            _previousQuestion();
          } else if (details.primaryVelocity! < 0) {
            _nextQuestion();
          }
        },
        child: ListView(
          padding: EdgeInsets.all(16.0),
          children: [
            Text(
              "Question ${_currentQuestionIndex + 1}:",
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            SizedBox(height: 8.0),
            Text(
              _questions[_currentQuestionIndex].questionText,
              style: TextStyle(fontSize: 16),
            ),
            SizedBox(height: 16.0),
            ..._questions[_currentQuestionIndex].options.asMap().entries.map((entry) {
              final optionIndex = entry.key;
              final optionText = entry.value;
              return InkWell( // Added this InkWell
                onTap: () {
                  setState(() {
                    _selectedAnswerIndex = optionIndex;
                    _userAnswers[_currentQuestionIndex] = optionIndex; // Store user's answer
                  });
                },
                child: ListTile(
                  title: Text(optionText),
                  leading: Radio<int>(
                    value: optionIndex,
                    groupValue: _selectedAnswerIndex,
                    onChanged: (int? value) {
                      setState(() {
                        _selectedAnswerIndex = value;
                        _userAnswers[_currentQuestionIndex] = value; // Store user's answer
                      });
                    },
                  ),
                ),
              );
            }).toList(),
            // Show correct answer if an option is selected
            if (_selectedAnswerIndex != null)
              Text(
                "Correct Answer: ${_questions[_currentQuestionIndex].options[_questions[_currentQuestionIndex].correctAnswerIndex]}",
                style: TextStyle(
                  fontSize: 16,
                  fontWeight: FontWeight.bold,
                  color: Colors.green, // Set your desired color here
                ),
              ),

            MyBannerAdWidget(), // Add the banner ad here

          ],
        ),
      ),
      bottomNavigationBar: Container(
        color: Colors.red[400],
        child: Theme(
          data: Theme.of(context).copyWith(
            canvasColor: Colors.blueAccent[200],
          ),
          child: BottomNavigationBar(
            type: BottomNavigationBarType.fixed,
            items: const [
              BottomNavigationBarItem(
                icon: Icon(Icons.arrow_back, color: Colors.red, size: 40),
                label: '',
              ),
              BottomNavigationBarItem(
                icon: Icon(Icons.arrow_forward_rounded, color: Colors.red, size: 40),
                label: '',
              ),
            ],
            onTap: (index) {
              if (index == 0) {
                _previousQuestion();
              } else if (index == 1) {
                _nextQuestion();
              }
            },
          ),
        ),
      ),
      // Overall exam timer display

      // Overall exam timer display
      // Overall exam timer display
      persistentFooterButtons: [
        Text(
          'Elapsed Time: ${_elapsedTimeInSeconds ~/ 60}:${(_elapsedTimeInSeconds % 60).toString().padLeft(2, '0')}',
          style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
        ),
      ],

    );
  }
  @override
  void dispose() {
    // Dispose of the exam timer when the widget is disposed
    _examTimer.cancel();
    super.dispose();
  }
}

class ResultsScreen extends StatelessWidget {
  final int elapsedTimeInSeconds;
  final List<int?> userAnswers;
  final List<Question> questions;

  ResultsScreen({required this.userAnswers, required this.questions, required this.elapsedTimeInSeconds});


  int calculateScore() {
    int score = 0;
    for (int i = 0; i < questions.length; i++) {
      if (userAnswers[i] != null && userAnswers[i] == questions[i].correctAnswerIndex) {
        score++;
      }
    }
    return score;
  }
  String formatElapsedTime(int seconds) {
    int minutes = seconds ~/ 60;
    int remainingSeconds = seconds % 60;
    return '$minutes:${remainingSeconds.toString().padLeft(2, '0')}';
  }
  @override
  Widget build(BuildContext context) {
    final int score = calculateScore();
    final String completedTime = formatElapsedTime(elapsedTimeInSeconds);
    return Scaffold(
      appBar: AppBar(
        title: Text("Results"),
        actions: [
          Padding(
            padding: EdgeInsets.all(16.0),
            child: Text("Completed Time: $completedTime" ),
          ),
        ],
      ),
      body: ListView(
        padding: EdgeInsets.all(16.0),
        children: [
          Text(
            "Your Score: $score/${questions.length}",
            style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
          ),
          SizedBox(height: 16.0),
          for (int i = 0; i < questions.length; i++) ...[
            Text(
              "Question ${i + 1}:",
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            SizedBox(height: 8.0),
            Text(
              questions[i].questionText,
              style: TextStyle(fontSize: 16),
            ),
            SizedBox(height: 8.0),
            Text(
              "Your Answer: ${userAnswers[i] != null ? questions[i].options[userAnswers[i]!] : 'Not answered'}",
              style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
            ),
            Text(
              "Correct Answer: ${questions[i].options[questions[i].correctAnswerIndex]}",
              style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
            ),
            SizedBox(height: 16.0),
            Text(
              "Explanation: ${questions[i].explanation}",
              style: TextStyle(fontSize: 16),
            ),
            SizedBox(height: 16.0),

          ],
        ],
      ),
    );
  }
}

void main() {
  runApp(MaterialApp(
    home: national_income(),
  ));
}
